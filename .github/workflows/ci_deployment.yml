name: Build website

on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [10.x]
    steps:
    - uses: actions/checkout@v1
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v1
      with:
        node-version: ${{ matrix.node-version }}
    - name: Install Dependencies
      run: npm install
      env:
        CI: true
    - name: Run Linting
      run: npm run lint
      env:
        CI: true
    - name: Build Prod bundle
      run: npm run build:prod
      env:
        CI: true
  delpoy:
    runs-on: ubuntu-latest
    if: github.ref == 'master'
    steps:
    - name: Do deploy
      run: |
        echo $PWD
        echo "GITHUB_TOKEN", $GITHUB_TOKEN
        git config credential.helper 'cache --timeout=120'
        git config --global user.email "github_actions@github.com"
        git config --global user.name "Github Actions Bot"
        git checkout master
        git remote rm origin
        git remote add origin https://github_action:$GITHUB_TOKEN@github.com/$GITHUB_REPOSITORY.git
        git remote -v
        git branch
        git status
        git add .
        git commit -m "Deploying to github-pages"
        git log -n 5
        git push origin master
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

